Расширение диска в Ubuntu с использованием LVM
Этот мини-гайд описывает процесс расширения диска в системе Ubuntu, где используется Logical Volume Manager (LVM). Это полезно, например, после увеличения размера виртуального диска в облаке или гипервизоре. Гайд включает базовые шаги по расширению, а также другие полезные команды для работы с LVM.
Предупреждение: Все команды выполняются с правами root (используйте sudo). Перед работой сделайте резервную копию данных, так как ошибки могут привести к потере информации. Замените устройства (/dev/sda, /dev/sda2, ubuntu-vg, ubuntu-lv) на ваши реальные.
Основные шаги по расширению диска

Пересканировать диск
Это обновляет информацию о размере диска после его физического увеличения.
textecho 1 | sudo tee /sys/class/scsi_device/*/device/rescan

Расширить раздел диска (если нужно)
Если раздел не занимает весь диск (например, после увеличения диска), используйте growpart из пакета cloud-utils-growpart (установите его: sudo apt install cloud-utils). Это расширяет раздел без потери данных.
Пример: расширить второй раздел на /dev/sda.
textsudo growpart /dev/sda 2

Расширить физический том (PV)
Обновляет PV после изменения размера раздела. Замените /dev/sda2 на ваш PV (проверьте с pvdisplay).
textsudo pvresize /dev/sda2

Расширить логический том (LV)
Распределяет свободное пространство на LV. Замените /dev/ubuntu-vg/ubuntu-lv на ваш LV (проверьте с lvdisplay).
textsudo lvextend -l +100%FREE /dev/ubuntu-vg/ubuntu-lv

Расширить файловую систему
Адаптирует файловую систему (ext4) к новому размеру LV.
textsudo resize2fs /dev/ubuntu-vg/ubuntu-lv


После выполнения проверьте размер: df -h.
Другие полезные команды для работы с LVM
Просмотр информации

pvdisplay: Показать детали физических томов (PV).
vgdisplay: Показать детали групп томов (VG).
lvdisplay: Показать детали логических томов (LV).
pvs, vgs, lvs: Краткие версии для просмотра PV, VG, LV.

Создание и расширение

pvcreate /dev/sdX: Создать новый PV на устройстве.
vgcreate my-vg /dev/sdX: Создать новую группу томов (VG).
vgextend my-vg /dev/sdY: Расширить VG, добавив новый PV.
lvcreate -L 10G -n my-lv my-vg: Создать новый LV размером 10 ГБ.

Уменьшение и удаление

lvreduce -L -5G /dev/my-vg/my-lv: Уменьшить LV на 5 ГБ (сначала уменьшите FS с resize2fs!).
lvremove /dev/my-vg/my-lv: Удалить LV.
vgreduce my-vg /dev/sdX: Удалить PV из VG.
vgremove my-vg: Удалить VG.
pvremove /dev/sdX: Удалить PV.

Дополнительные утилиты

lsblk: Показать структуру дисков и разделов.
fdisk -l или parted -l: Просмотр разделов диска.
vgscan, pvscan, lvscan: Сканировать и обновить информацию о LVM.

Для более сложных сценариев обратитесь к документации: man lvm или официальному руководству Ubuntu.
